# 组件开发

## 组件命名

- 功能组件放在 `src/<Feature>/index.vue`。
- 通用组件放在 `src/components/` 目录，使用 `cu-` 前缀（如 `cu-button.vue`）。
- 业务组件放在 `src/components/business/` 目录，使用 `biz-` 前缀（如 `biz-feature-card.vue`）。

## Props 类型

- 使用 TypeScript 严格类型定义 Props。
- 使用 `defineProps` 和 `withDefaults` 定义默认值。

```typescript
// ✅ 正确：类型安全的 Props
interface Props {
  enterAction: PluginEnterAction
  title?: string
}

const props = withDefaults(defineProps<Props>(), {
  title: '默认标题'
})
```

## 事件处理

- 使用 `defineEmits` 定义事件。
- 事件名使用 kebab-case。

```typescript
// ✅ 正确：类型安全的事件
const emit = defineEmits<{
  update: [value: string]
  delete: [id: string]
}>()

emit('update', 'new value')
emit('delete', '123')
```

## 类型守卫

- 使用类型守卫区分不同的 `PluginEnterAction` 类型。
- 参考 `src/Write/index.vue` 的模式。

```typescript
// ✅ 正确：类型守卫
type TextEnterAction = PluginEnterAction<string>
type ImageEnterAction = PluginEnterAction<string>

const isTextEnterAction = (action: PluginEnterAction): action is TextEnterAction => 
  action.type === 'over'

const isImageEnterAction = (action: PluginEnterAction): action is ImageEnterAction => 
  action.type === 'img'

// 使用类型守卫
if (isTextEnterAction(enterAction)) {
  // 处理文本类型
} else if (isImageEnterAction(enterAction)) {
  // 处理图片类型
}
```

## 组件示例

### 功能组件

```vue
<!-- src/Read/index.vue -->
<script setup lang="ts">
import { ref, watch } from 'vue'
import type { PluginEnterAction } from '../types/utools'

interface FilesPayloadItem {
  path: string
}

const props = defineProps<{
  enterAction: PluginEnterAction
}>()

const filePath = ref<string>('')
const fileContent = ref<string>('')
const error = ref<string>('')

const isFilesEnterAction = (
  action: PluginEnterAction,
): action is PluginEnterAction<FilesPayloadItem[]> => {
  return action.type === 'files' && Array.isArray(action.payload)
}

const readFileSafely = (targetPath: string) => {
  try {
    const content = window.services.readFile(targetPath)
    fileContent.value = content
    error.value = ''
  } catch (err) {
    error.value = err instanceof Error ? err.message : String(err)
    fileContent.value = ''
  }
}

watch(
  () => props.enterAction,
  (enterAction) => {
    if (!isFilesEnterAction(enterAction) || enterAction.payload.length === 0) {
      return
    }

    const targetFile = enterAction.payload[0]?.path
    if (!targetFile) {
      return
    }

    filePath.value = targetFile
    readFileSafely(targetFile)
  },
  {
    immediate: true,
  },
)
</script>

<template>
  <div class="read">
    <div class="read-file">{{ filePath }}</div>
    <template v-if="!!fileContent">
      <pre>{{ fileContent }}</pre>
    </template>
    <template v-if="!!error">
      <div class="read-error">{{ error }}</div>
    </template>
  </div>
</template>

<style scoped>
.read {
  padding: 20px;
  box-sizing: border-box;
}
</style>
```

### 通用组件

```vue
<!-- src/components/cu-button.vue -->
<script setup lang="ts">
interface Props {
  text: string
  type?: 'primary' | 'secondary' | 'danger'
  disabled?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  type: 'primary',
  disabled: false
})

const emit = defineEmits<{
  click: []
}>()

const handleClick = () => {
  if (!props.disabled) {
    emit('click')
  }
}
</script>

<template>
  <button 
    :class="['cu-button', `cu-button-${type}`, { disabled }]"
    @click="handleClick"
  >
    {{ text }}
  </button>
</template>

<style scoped>
.cu-button {
  padding: 8px 16px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.cu-button.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
</style>
```

## 组件最佳实践

1. **单一职责**：每个组件只负责一个功能
2. **可复用性**：通用组件应该可复用，避免硬编码
3. **类型安全**：使用 TypeScript 严格类型定义
4. **错误处理**：组件内部处理错误，对外暴露清晰的错误信息
5. **性能优化**：使用 `computed` 缓存计算结果，避免不必要的重新渲染
