# 测试规范

> 注意：本文档为未来扩展准备，当前项目如不需要可暂时忽略。

## 单元测试

### 测试工具函数

- 测试工具函数和业务逻辑。
- 使用 Vitest 或 Jest 进行单元测试。
- 测试覆盖率目标：80% 以上。

```typescript
// ✅ 正确：单元测试
import { describe, it, expect } from 'vitest'
import { validateData } from '@/utils/validation'

describe('validateData', () => {
  it('should validate valid data', () => {
    const data = { name: 'John', email: 'john@example.com' }
    const result = validateData(data)
    expect(result.valid).toBe(true)
    expect(result.errors).toHaveLength(0)
  })

  it('should reject invalid data', () => {
    const data = { name: '', email: 'invalid' }
    const result = validateData(data)
    expect(result.valid).toBe(false)
    expect(result.errors.length).toBeGreaterThan(0)
  })
})
```

### 测试 Store

```typescript
// ✅ 正确：Store 测试
import { describe, it, expect } from 'vitest'
import { useItemStore } from '@/stores/item'

describe('ItemStore', () => {
  it('should add item', async () => {
    const store = useItemStore()
    const item = await store.addItem({ name: 'Test', price: 100 })
    expect(item.id).toBeDefined()
    expect(store.items).toContain(item)
  })

  it('should delete item', async () => {
    const store = useItemStore()
    const item = await store.addItem({ name: 'Test', price: 100 })
    await store.deleteItem(item.id)
    expect(store.items).not.toContain(item)
  })
})
```

## 组件测试

### 测试组件渲染

- 测试组件渲染和交互。
- 使用 Vue Test Utils 进行组件测试。
- 测试组件的 Props、Events、Slots 等。

```typescript
// ✅ 正确：组件测试
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import CuButton from '@/components/cu-button.vue'

describe('CuButton', () => {
  it('should render button text', () => {
    const wrapper = mount(CuButton, {
      props: { text: 'Click me' }
    })
    expect(wrapper.text()).toContain('Click me')
  })

  it('should emit click event', async () => {
    const wrapper = mount(CuButton, {
      props: { text: 'Click me' }
    })
    await wrapper.find('button').trigger('click')
    expect(wrapper.emitted('click')).toBeTruthy()
  })
})
```

### 测试组件交互

```typescript
// ✅ 正确：组件交互测试
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import Read from '@/Read/index.vue'

describe('Read', () => {
  it('should read file on enter', async () => {
    const enterAction = {
      code: 'read',
      type: 'files',
      payload: [{ path: '/test/file.txt' }],
      option: {}
    }
    const wrapper = mount(Read, {
      props: { enterAction }
    })
    await wrapper.vm.$nextTick()
    expect(wrapper.find('.read-file').text()).toContain('/test/file.txt')
  })
})
```

## 集成测试

### 测试完整功能流程

- 测试完整功能流程。
- 测试各层之间的协作。
- 测试错误处理和边界情况。

```typescript
// ✅ 正确：集成测试
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import App from '@/App.vue'

describe('App Integration', () => {
  it('should handle plugin enter', async () => {
    const wrapper = mount(App)
    const enterAction = {
      code: 'hello',
      type: 'text',
      payload: 'test',
      option: {}
    }
    window.utools.onPluginEnter(enterAction)
    await wrapper.vm.$nextTick()
    expect(wrapper.find('Hello').exists()).toBe(true)
  })
})
```

## 错误测试

### 测试错误处理

- 测试错误处理和边界情况。
- 测试异常情况的恢复机制。
- 测试用户提示和日志记录。

```typescript
// ✅ 正确：错误测试
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import Read from '@/Read/index.vue'

describe('Read Error Handling', () => {
  it('should handle file read error', async () => {
    const enterAction = {
      code: 'read',
      type: 'files',
      payload: [{ path: '/nonexistent/file.txt' }],
      option: {}
    }
    const wrapper = mount(Read, {
      props: { enterAction }
    })
    await wrapper.vm.$nextTick()
    expect(wrapper.find('.read-error').exists()).toBe(true)
  })
})
```

## 测试工具配置

### Vitest 配置

```typescript
// ✅ 正确：Vitest 配置
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [vue()],
  test: {
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: ['node_modules/', 'dist/']
    }
  }
})
```

### 测试脚本

```json
// ✅ 正确：package.json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  }
}
```

## 测试最佳实践

1. **测试覆盖**：确保关键功能有测试覆盖
2. **测试隔离**：每个测试应该独立，不依赖其他测试
3. **测试命名**：使用清晰的测试名称，说明测试内容
4. **测试数据**：使用测试数据，避免依赖真实数据
5. **错误测试**：测试错误处理和边界情况
6. **性能测试**：对性能关键功能进行性能测试

## 测试类型

### 单元测试

- 测试单个函数或组件
- 快速执行，易于维护
- 覆盖率目标：80% 以上

### 组件测试

- 测试组件渲染和交互
- 测试 Props、Events、Slots
- 使用 Vue Test Utils

### 集成测试

- 测试完整功能流程
- 测试各层之间的协作
- 测试错误处理和边界情况

### E2E 测试

- 测试完整用户流程
- 使用 Playwright 或 Cypress
- 测试真实用户场景

## 持续集成

### CI/CD 配置

```yaml
# ✅ 正确：CI/CD 配置
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm install
      - run: npm run test
      - run: npm run test:coverage
```

## 最佳实践

1. **测试驱动开发**：先写测试，再写代码
2. **测试覆盖率**：保持测试覆盖率在 80% 以上
3. **测试隔离**：每个测试应该独立，不依赖其他测试
4. **测试命名**：使用清晰的测试名称，说明测试内容
5. **错误测试**：测试错误处理和边界情况
6. **持续集成**：在 CI/CD 中运行测试
